<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Generator</title>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h1, h2, h3 {
      color: #333;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    h2 {
      font-size: 1.5em;
      margin-bottom: 15px;
    }
    .form-section, .preview-section {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }
    .form-group {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .item-row {
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 100px;
      gap: 10px;
      margin-bottom: 10px;
      align-items: center;
    }
    input, button {
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 1em;
    }
    input:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 5px rgba(0, 123, 255, 0.3);
    }
    input[readonly] {
      background-color: #e9ecef;
      cursor: not-allowed;
    }
    button {
      background: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #0056b3;
    }
    .remove-btn {
      background: #dc3545;
    }
    .remove-btn:hover {
      background: #b02a37;
    }
    .add-btn {
      background: #28a745;
    }
    .add-btn:hover {
      background: #1e7e34;
    }
    .error {
      color: #dc3545;
      margin-bottom: 15px;
      padding: 10px;
      border-left: 4px solid #dc3545;
      background: #f8d7da;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 10px;
      text-align: left;
    }
    th {
      background: #f1f1f1;
    }
    .text-right {
      text-align: right;
    }
    .download-btn {
      display: block;
      width: 200px;
      margin: 20px auto;
      padding: 12px;
      background: #28a745;
    }
    .download-btn:hover {
      background: #1e7e34;
    }
    @media (max-width: 600px) {
      .item-row {
        grid-template-columns: 1fr;
      }
      .form-group {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <h1>Invoice Generator</h1>
  <div id="error" class="error" style="display: none;"></div>

  <!-- Form Section -->
  <div class="form-section">
    <h2>Enter Invoice Details</h2>
    
    <!-- Business Information -->
    <h3>Business Information</h3>
    <div class="form-group">
      <input type="text" id="business-name" value="AAMS" readonly>
      <input type="text" id="business-address" value="Kurla Camp, Ulhasnagar 4" readonly>
      <input type="email" id="business-email" value="aams.help@gmail.com" readonly>
    </div>

    <!-- Client Information -->
    <h3>Client Information</h3>
    <div class="form-group">
      <input type="text" id="client-name" placeholder="Client Name *" required>
      <input type="text" id="client-address" placeholder="Client Address *" required>
      <input type="email" id="client-email" placeholder="Client Email *" required>
    </div>

    <!-- Invoice Details -->
    <h3>Invoice Details</h3>
    <div class="form-group">
      <input type="text" id="invoice-number" readonly>
      <input type="text" id="serial-number" placeholder="Serial Number *" required>
      <input type="date" id="invoice-date" readonly>
      <input type="time" id="invoice-time" readonly>
    </div>

    <!-- Items -->
    <h3>Items</h3>
    <div id="items">
      <div class="item-row">
        <input type="text" class="item-description" placeholder="Product Description *" required>
        <input type="number" class="item-quantity" placeholder="Quantity" min="1" value="1" required>
        <input type="number" class="item-unit-price" placeholder="Unit Price *" min="0" step="0.01" required>
        <button class="remove-btn" onclick="removeItem(this)">Remove</button>
      </div>
    </div>
    <button class="add-btn" onclick="addItem()">Add Item</button>
  </div>

  <!-- Invoice Preview -->
  <div class="preview-section">
    <h2 id="preview-title">AAMS Invoice</h2>
    <div class="form-group">
      <div>
        <p><strong>From:</strong></p>
        <p id="preview-business-name">AAMS</p>
        <p id="preview-business-address">Kurla Camp, Ulhasnagar 4</p>
        <p id="preview-business-email">aams.help@gmail.com</p>
      </div>
      <div>
        <p><strong>To:</strong></p>
        <p id="preview-client-name">Client Name</p>
        <p id="preview-client-address">Client Address</p>
        <p id="preview-client-email">Client Email</p>
      </div>
    </div>
    <div>
      <p><strong>Invoice Number:</strong> <span id="preview-invoice-number">N/A</span></p>
      <p><strong>Serial Number:</strong> <span id="preview-serial-number">N/A</span></p>
      <p><strong>Date:</strong> <span id="preview-invoice-date"></span></p>
      <p><strong>Time:</strong> <span id="preview-invoice-time"></span></p>
    </div>
    <table>
      <thead>
        <tr>
          <th>Description</th>
          <th class="text-right">Quantity</th>
          <th class="text-right">Unit Price</th>
          <th class="text-right">Total</th>
        </tr>
      </thead>
      <tbody id="preview-items"></tbody>
    </table>
    <div class="text-right">
      <p><strong>Total:</strong> ₹<span id="preview-total">0.00</span></p>
    </div>
  </div>

  <!-- Download Button -->
  <button class="download-btn" onclick="generatePDF()">Download Invoice as PDF</button>

  <script>
    const { jsPDF } = window.jspdf;
    const today = new Date();
    const formattedDate = today.toISOString().split('T')[0];
    const formattedTime = today.toTimeString().split(' ')[0].slice(0, 5);
    document.getElementById('invoice-date').value = formattedDate;
    document.getElementById('invoice-time').value = formattedTime;

    function formatInvoiceNumber(serialNumber) {
      const date = new Date();
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const year = date.getFullYear();
      return `AAMS-RETAIL-${day}${month}${year}-${serialNumber || 'N/A'}`;
    }

    function addItem() {
      const itemsContainer = document.getElementById('items');
      const itemRow = document.createElement('div');
      itemRow.className = 'item-row';
      itemRow.innerHTML = `
        <input type="text" class="item-description" placeholder="Product Description *" required>
        <input type="number" class="item-quantity" placeholder="Quantity" min="1" value="1" required>
        <input type="number" class="item-unit-price" placeholder="Unit Price *" min="0" step="0.01" required>
        <button class="remove-btn" onclick="removeItem(this)">Remove</button>
      `;
      itemsContainer.appendChild(itemRow);
      attachInputListeners();
      updatePreview();
    }

    function removeItem(button) {
      button.parentElement.remove();
      updatePreview();
    }

    function attachInputListeners() {
      const inputs = document.querySelectorAll('input:not([readonly])');
      inputs.forEach(input => {
        input.addEventListener('input', updatePreview);
      });
    }

    function updatePreview() {
      // Business Info (hardcoded, non-editable)
      document.getElementById('preview-business-name').textContent = 'AAMS';
      document.getElementById('preview-business-address').textContent = 'Kurla Camp, Ulhasnagar 4';
      document.getElementById('preview-business-email').textContent = 'aams.help@gmail.com';
      document.getElementById('preview-title').textContent = 'AAMS Invoice';

      // Client Info
      document.getElementById('preview-client-name').textContent = document.getElementById('client-name').value || 'Client Name';
      document.getElementById('preview-client-address').textContent = document.getElementById('client-address').value || 'Client Address';
      document.getElementById('preview-client-email').textContent = document.getElementById('client-email').value || 'Client Email';

      // Invoice Info
      const serialNumber = document.getElementById('serial-number').value;
      document.getElementById('invoice-number').value = formatInvoiceNumber(serialNumber);
      document.getElementById('preview-invoice-number').textContent = formatInvoiceNumber(serialNumber);
      document.getElementById('preview-serial-number').textContent = serialNumber || 'N/A';
      document.getElementById('preview-invoice-date').textContent = formattedDate;
      document.getElementById('preview-invoice-time').textContent = formattedTime;

      // Items
      const items = document.querySelectorAll('.item-row');
      const previewItems = document.getElementById('preview-items');
      previewItems.innerHTML = '';
      let total = 0;
      items.forEach(item => {
        const description = item.querySelector('.item-description').value || 'N/A';
        const quantity = parseInt(item.querySelector('.item-quantity').value) || 1;
        const unitPrice = parseFloat(item.querySelector('.item-unit-price').value) || 0;
        const itemTotal = quantity * unitPrice;
        total += itemTotal;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${description}</td>
          <td class="text-right">${quantity}</td>
          <td class="text-right">₹${unitPrice.toFixed(2)}</td>
          <td class="text-right">₹${itemTotal.toFixed(2)}</td>
        `;
        previewItems.appendChild(row);
      });

      // Total
      document.getElementById('preview-total').textContent = total.toFixed(2);
    }

    function validateForm() {
      const errorDiv = document.getElementById('error');
      errorDiv.style.display = 'none';
      errorDiv.textContent = '';

      if (!document.getElementById('client-name').value) {
        errorDiv.textContent = 'Please enter the client name.';
        errorDiv.style.display = 'block';
        return false;
      }
      if (!document.getElementById('client-address').value) {
        errorDiv.textContent = 'Please enter the client address.';
        errorDiv.style.display = 'block';
        return false;
      }
      if (!document.getElementById('client-email').value) {
        errorDiv.textContent = 'Please enter the client email.';
        errorDiv.style.display = 'block';
        return false;
      }
      if (!document.getElementById('serial-number').value) {
        errorDiv.textContent = 'Please enter the serial number.';
        errorDiv.style.display = 'block';
        return false;
      }
      const items = document.querySelectorAll('.item-row');
      for (let item of items) {
        if (!item.querySelector('.item-description').value) {
          errorDiv.textContent = 'Please enter a description for all items.';
          errorDiv.style.display = 'block';
          return false;
        }
        if (parseFloat(item.querySelector('.item-unit-price').value) <= 0) {
          errorDiv.textContent = 'Please enter a valid unit price for all items.';
          errorDiv.style.display = 'block';
          return false;
        }
      }
      return true;
    }

    function generatePDF() {
      if (!validateForm()) return;

      const doc = new jsPDF();
      doc.setFontSize(18);
      doc.text('INVOICE', 105, 20, { align: 'center' });
      doc.setFontSize(12);
      doc.setLineWidth(0.5);
      doc.line(20, 25, 190, 25);

      // Business Information
      doc.text('From:', 20, 35);
      doc.text('AAMS', 20, 42);
      doc.text('Kurla Camp, Ulhasnagar 4', 20, 49);
      doc.text('Email: aams.help@gmail.com', 20, 56);

      // Client Information
      doc.text('To:', 110, 35);
      doc.text(document.getElementById('client-name').value, 110, 42);
      doc.text(document.getElementById('client-address').value, 110, 49);
      doc.text(`Email: ${document.getElementById('client-email').value}`, 110, 56);

      // Invoice Details
      const serialNumber = document.getElementById('serial-number').value;
      doc.text(`Invoice Number: ${formatInvoiceNumber(serialNumber)}`, 20, 75);
      doc.text(`Serial Number: ${serialNumber}`, 20, 82);
      doc.text(`Date: ${formattedDate}`, 110, 75);
      doc.text(`Time: ${formattedTime}`, 110, 82);

      // Itemized Table
      doc.setFillColor(240, 240, 240);
      doc.rect(20, 90, 170, 10, 'F');
      doc.text('Description', 22, 96);
      doc.text('Qty', 100, 96, { align: 'right' });
      doc.text('Unit Price', 140, 96, { align: 'right' });
      doc.text('Total', 180, 96, { align: 'right' });

      let y = 103;
      let total = 0;
      const items = document.querySelectorAll('.item-row');
      items.forEach(item => {
        const description = item.querySelector('.item-description').value;
        const quantity = parseInt(item.querySelector('.item-quantity').value) || 1;
        const unitPrice = parseFloat(item.querySelector('.item-unit-price').value) || 0;
        const itemTotal = quantity * unitPrice;
        total += itemTotal;
        doc.text(description.substring(0, 30), 22, y);
        doc.text(quantity.toString(), 100, y, { align: 'right' });
        doc.text(`₹${unitPrice.toFixed(2)}`, 140, y, { align: 'right' });
        doc.text(`₹${itemTotal.toFixed(2)}`, 180, y, { align: 'right' });
        y += 8;
      });

      // Total
      doc.line(20, y, 190, y);
      y += 8;
      doc.text(`Total: ₹${total.toFixed(2)}`, 140, y, { align: 'right' });

      doc.save(`invoice_${formatInvoiceNumber(serialNumber)}.pdf`);
    }

    attachInputListeners();
    updatePreview();
  </script>
</body>
</html>